<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Auto Kirim Lokasi ke Supabase</title>
</head>
<body>
  <h1>Auto Kirim Lokasi</h1>
  <p>
    Dengan membuka halaman ini, browser kamu akan meminta izin untuk mengakses lokasi.
    Jika kamu menekan <strong>Allow</strong>, lokasi akan dikirim ke database Supabase saya.
  </p>
  <pre id="status"></pre>

  <script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  <script>
    const statusEl = document.getElementById("status");

    function log(msg) {
      statusEl.textContent += msg + "\n";
    }

    const SUPABASE_URL = "https://yfwnfaocsswqerhgxkto.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlmd25mYW9jc3N3cWVyaGd4a3RvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyNjE3MTksImV4cCI6MjA4MDgzNzcxOX0.8ADF4wgcEv_lI2qOPcDt1OujckrIBoDYE52wIE8YZEM";

    const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function sendLocation() {
      if (!navigator.geolocation) {
        log("Geolocation tidak didukung di browser ini.");
        return;
      }

      log("Meminta izin lokasi...");

      navigator.geolocation.getCurrentPosition(
        async (pos) => {
          const payload = {
            lat: pos.coords.latitude,
            lon: pos.coords.longitude,
            accuracy: pos.coords.accuracy,
            user_agent: navigator.userAgent
          };

          log("Lokasi didapat:");
          log(JSON.stringify(payload, null, 2));
          log("Menyimpan ke Supabase...");

          const { data, error } = await client
            .from("locations")
            .insert(payload)
            .select();

          if (error) {
            log("Gagal simpan ke Supabase: " + error.message);
          } else {
            log("Berhasil simpan. Row:");
            log(JSON.stringify(data, null, 2));
          }
        },
        (err) => {
          log("Gagal ambil lokasi: " + err.message);
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 0
        }
      );
    }

    // otomatis jalan ketika halaman dibuka
    window.addEventListener("DOMContentLoaded", sendLocation);
  </script>
</body>
</html>
