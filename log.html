<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Log Lokasi - Supabase</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    table { border-collapse: collapse; width: 100%; margin-top: 1rem; font-size: 0.85rem; }
    th, td { border: 1px solid #ccc; padding: 6px 8px; text-align: left; }
    th { background: #f0f0f0; position: sticky; top: 0; }
    code { font-size: 0.8rem; }
  </style>
</head>
<body>
  <h1>Log Lokasi</h1>
  <p>Data ini diambil dari tabel <code>locations</code> di Supabase kamu.</p>

  <table id="log-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Waktu (UTC)</th>
        <th>Lat</th>
        <th>Lon</th>
        <th>Accuracy (m)</th>
        <th>User Agent</th>
        <th>Maps</th>
      </tr>
    </thead>
    <tbody>
      <tr><td colspan="7">Memuat data...</td></tr>
    </tbody>
  </table>

  <script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  <script>
    const SUPABASE_URL = "https://yfwnfaocsswqerhgxkto.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlmd25mYW9jc3N3cWVyaGd4a3RvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyNjE3MTksImV4cCI6MjA4MDgzNzcxOX0.8ADF4wgcEv_lI2qOPcDt1OujckrIBoDYE52wIE8YZEM";

    const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const tbody = document.querySelector("#log-table tbody");

    async function loadData() {
      const { data, error } = await client
        .from("locations")
        .select("*")
        .order("created_at", { ascending: false });

      tbody.innerHTML = "";

      if (error) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 7;
        td.textContent = "Error load data: " + error.message;
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }

      if (!data || data.length === 0) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 7;
        td.textContent = "Belum ada data.";
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }

      for (const row of data) {
        const tr = document.createElement("tr");

        const created = row.created_at;

        tr.innerHTML = `
          <td>${row.id}</td>
          <td>${created}</td>
          <td>${row.lat}</td>
          <td>${row.lon}</td>
          <td>${row.accuracy ?? ""}</td>
          <td><code>${(row.user_agent || "").slice(0, 60)}${row.user_agent && row.user_agent.length > 60 ? "..." : ""}</code></td>
          <td><a href="https://www.google.com/maps?q=${row.lat},${row.lon}" target="_blank">Buka</a></td>
        `;

        tbody.appendChild(tr);
      }
    }

    loadData();
  </script>
</body>
</html>
